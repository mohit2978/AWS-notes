# Lecture 19

Yesterday seen user and user groups 
Now we see IAM roles!! Roles are temporary access without credentials!!

In IAM we can create a role!! Roles is used when we do not want to keep keys in ec2 machine but want to access some AWS services through it!

The entity to which role is attached is called as __Trusted Entity__ ,in our case ec2 is trusted entity!!

Suppose we want to lambda to stop ec2 !! but lambda do not have permission to use ec2 !!

> Two services can not communicate with each other 

> To give any service access to another service we use IAM role!!

### Usecase of IAM role
- For services giving access Use IAM role!!
- For users to access AWS services temporily without credentials!!

IAM User is just login and permission with credentials!!

## Creation of role
 when create a role clicking on create role 

![alt text](image-1.png)

This is next page you get and so select what you want to attach role!! AWS service or account (we can give temporary permission to any user so he can login without crednetials)!!

we generating role for ec2 so AWS service and then on use-case select ec2!!

then click on next we need to give permission which service ec2 want to access so we give access to S3!!

then next give name and then finish!!

> to whom role is attached is trusted Entity!!

If giving IAM role to user you go to role and see URL as below

![alt text](image-2.png)

this url you give to user so he can login!!

or with Nitish account he login then on to right where account info is shown click that then switch role!! then add details!

![alt text](image-3.png)

Suppose Nitish is deleteing all data so now you can also revoke his all sessions too!!

![alt text](image-4.png)

## Policies associated with an IAM role
There are mutiple policies associated with an IAM role that dictate the scope of permissions of the role and the entities that are allowed to use the role. These policies are as follows:

- Trust policy: This is a resource-based policy that specifies the entities allowed to assume an IAM role.

- Permissions policy: This is an identity-based policy that specifies the permissions of the role.

![alt text](image.png)

>Note:An IAM role can have multiple permission policies attached to it, but there can only be one trust policy attached to it. Also, we can create an IAM role without a permission policy, but specifying a trust policy is required during the creation of an IAM role.

## Principal entities for an IAM role
Only the entities that are specified as the principal entities in the trust policy of an IAM role can assume that role. These principal entities are of multiple types. The types of principal entities for an IAM role are as follows:

- AWS services: An AWS service cannot use another service without proper authorization. That authorization is provided using the IAM roles. The Principal element of the trust policy is set to the service principal of the service in this case.

- IAM identities: Both IAM users and IAM roles can assume an IAM role to get the permissions provided to that role. The Principal element of the trust policy is set to the ARN of the IAM identity in this case.

- AWS accounts: Both the current and external accounts can use an IAM role to get the associated permissions. In this scenario, the Principal element of the trust policy is set to the ID of the account.

- Web identities: Users authenticated by specific external web identity providers can also be the principal entity for an IAM role. In this case, the Principal element of the trust policy is set to the DNS of the identity provider.

- External users: External users authenticated by an external identity provider (IdP) service that is compatible with SAML 2.0 OpenID Connect or a custom-built identity broker can also be specified as the principal entity in the trust policy of an IAM role.

## How IAM roles work

Following is the sequence of steps illustrating how a principal entity utilizes the IAM role:

- Assuming a role: An entity can assume an IAM role by making an AssumeRole API request or by assuming the role using temporary security credentials provided by another trusted entity.

- Temporary credentials: When an entity successfully assumes an IAM role, it receives temporary security credentials consisting of an access key ID, a secret access key, and a session token. These credentials are valid for a limited duration specified by the role's configuration.

IAM roles are powerful tools for managing access to AWS resources securely. By understanding their purpose and components, we can effectively leverage IAM roles to grant temporary, fine-grained permissions to entities within and outside our AWS account, ensuring secure and efficient resource access.

